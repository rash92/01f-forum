{{ template "header" . }}
{{$PostInfo := .Post}}
{{$UserInfo := .UserInfo}}
<div class="container-post">
    <div class="single-post">
        {{if or (eq $UserInfo.Permission "moderator") (eq $UserInfo.Permission "admin")}}
        <div class="report-post">
            <form action="/posts/{{$PostInfo.UUID}}" method="post">
            <button class="report-btn" name="reportpost" value="{{$PostInfo.UUID}}">
                report post
            </button>
            <button class="delete-btn" name="deletepost" value="{{$PostInfo.UUID}}">
                delete post
            </button>
            </form>
        </div>
        {{end}}
        
        <div class="single-post-title">
            <h2>{{$PostInfo.Title}}</h2>
        </div>
        <div class="post-tags">
			{{range $PostInfo.Tags}}
			<a class="tag-link" href="/categories/{{.TagName}}">{{.TagName}}</a>
			{{end}}
		</div>
        <div class="single-post-author">
            <p>Posted by {{$PostInfo.OwnerId}} at {{$PostInfo.FormattedTime}}</p>
        </div>
        {{if ne $PostInfo.ImageName ""}}
        <div class="post-image">
            <img src={{$PostInfo.ImageName}}
                alt="user submitted image">
        </div>
        {{end}}
        <div class="single-post-content">
            <p>{{$PostInfo.Content}}</p>
        </div>
        <div class="post-comments-likes-dislikes">
            <div>
                <p><i class="fa-regular fa-comment"></i> {{.NumOfComments}}</p>
            </div>
            <form action="/posts/{{$PostInfo.UUID}}" method="post">
                <div class="post-likes-dislikes">
                    {{if ne $UserInfo.Name "" }}
                    <button class="like" name="like" value="{{$PostInfo.UUID}}"><i class="fa-solid fa-thumbs-up"></i></button>
                    {{ else }}
                    <p><i class="fa-solid fa-thumbs-up"></i></p>
                    {{end}}
                    <p>{{$PostInfo.Likes}}</p>
                    {{if ne $UserInfo.Name "" }}
                    <button class="dislike" name="dislike" value="{{$PostInfo.UUID}}"><i
                            class="fa-solid fa-thumbs-down"></i></button>
                    {{else}}
                    <p><i class="fa-solid fa-thumbs-down"></i></p>
                    {{end}}
                    <p>{{$PostInfo.Dislikes}}</p>
                </div>
            </form>
        </div>
        {{if ne $UserInfo.Name ""}}
        <form action="/posts/{{$PostInfo.UUID}}" method="POST">
            <textarea name="comment" id="" cols="30" rows="5" placeholder="Comment" autofocus required></textarea>
         </textarea>
            <button type="submit">Comment</button>
        </form>
        {{else}}
        <p>Click <a href="/register">here</a> to reigster to make a comment</p>
        {{end}}
    </div>
    {{range .Comments}}
    <div class="single-post">
        <div class="commentor-name-time">
            <p>{{.OwnerName}} - {{.FormattedTime}}</p>
        </div>
        <div class="comment">
            <p>{{.Content}}</p>
        </div>

        <form action="/posts/{{$PostInfo.UUID}}" method="post">
			<div class="post-likes-dislikes">
				{{if ne $UserInfo.Name "" }}
				<button class="like" name="commentlike" value="{{.UUID}}"><i class="fa-solid fa-thumbs-up"></i></button>
				{{ else }}
				<p><i class="fa-solid fa-thumbs-up"></i></p>
				{{end}}
				<p>{{.Likes}}</p>
				{{if ne $UserInfo.Name "" }}
				<button class="dislike" name="commentdislike" value="{{.UUID}}"><i
						class="fa-solid fa-thumbs-down"></i></button>
				{{else}}
				<p><i class="fa-solid fa-thumbs-down"></i></p>
				{{end}}
				<p>{{.Dislikes}}</p>
			</div>
		</form>
    </div>
    {{end}}
</div>
{{template "footer"}}